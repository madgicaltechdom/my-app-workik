appId: com.madgicaltechdom.storageapp

env:
  VALID_EMAIL: "test@example.com"
  VALID_PASSWORD: "Password123!"
  DISPLAY_NAME: "Test User"

flows:
  main:
    # Load Page Object Model
    - runScript: ../../elements/auth.js
    
    # Launch app with clean state
    - launchApp:
        clearState: true
        
    # Verify initial state - should be on login screen
    - assertVisible:
        id: ${output.login.screen}
    - assertVisible:
        id: ${output.login.title}
    - assertVisible:
        text: "Welcome Back"
        
    # Verify all login form elements are present
    - assertVisible:
        id: ${output.login.emailInput}
    - assertVisible:
        id: ${output.login.passwordInput}
    - assertVisible:
        id: ${output.login.submitButton}
    - assertVisible:
        id: ${output.login.signupLink}
    - assertVisible:
        id: ${output.login.forgotPasswordLink}
        
    # Verify initial form state
    - assertVisible:
        id: ${output.login.submitButton}
        enabled: false
        
    # Test Case 1: Successful Login Flow
    - tapOn:
        id: ${output.login.emailInput}
    - inputText: ${VALID_EMAIL}
    
    # Verify button is still disabled with only email filled
    - assertVisible:
        id: ${output.login.submitButton}
        enabled: false
        
    - tapOn:
        id: ${output.login.passwordInput}
    - inputText: ${VALID_PASSWORD}
    
    # Verify button is now enabled with both fields filled
    - assertVisible:
        id: ${output.login.submitButton}
        enabled: true
        
    # Submit the form
    - tapOn:
        id: ${output.login.submitButton}
        
    # Verify loading state appears
    - assertVisible:
        id: ${output.login.loadingOverlay}
        
    # Verify loading overlay has proper accessibility
    - assertVisible:
        id: ${output.login.loadingOverlay}
        accessibilityRole: "progressbar"
        accessibilityLabel: "Signing you in..."
        
    # Wait for authentication to complete
    - waitForAnimationToEnd
    
    # Verify successful navigation to home screen
    - assertVisible:
        id: ${output.home.screen}
    - assertVisible:
        id: ${output.home.title}
    - assertVisible:
        text: "Welcome Home"
        
    # Verify loading overlay is no longer visible
    - assertNotVisible:
        id: ${output.login.loadingOverlay}
        
    # Verify login screen is no longer visible
    - assertNotVisible:
        id: ${output.login.screen}
        
    # Test Case 2: Verify Home Screen Content
    - assertVisible:
        id: ${output.home.welcomeMessage}
    - assertVisible:
        id: ${output.home.contentContainer}
        
    # Test Case 3: Verify Navigation Tabs are Available
    - assertVisible:
        id: ${output.navigation.homeTab}
    - assertVisible:
        id: ${output.navigation.profileTab}
        
    # Test Case 4: Navigate to Profile Screen
    - tapOn:
        id: ${output.navigation.profileTab}
    - assertVisible:
        id: ${output.profile.screen}
    - assertVisible:
        id: ${output.profile.header}
        
    # Verify profile information is loaded
    - assertVisible:
        id: ${output.profile.email}
        text: ${VALID_EMAIL}
        
    # Test Case 5: Verify Profile Screen Elements
    - assertVisible:
        id: ${output.profile.displayName}
    - assertVisible:
        id: ${output.profile.editButton}
    - assertVisible:
        id: ${output.profile.logoutButton}
        
    # Test Case 6: Navigate Back to Home
    - tapOn:
        id: ${output.navigation.homeTab}
    - assertVisible:
        id: ${output.home.screen}
        
    # Test Case 7: Verify Session Persistence (App State)
    - assertVisible:
        id: ${output.home.welcomeMessage}
    - assertVisible:
        text: "Welcome Home"
        
    # Test Case 8: Test Logout Flow
    - tapOn:
        id: ${output.navigation.profileTab}
    - assertVisible:
        id: ${output.profile.screen}
    - tapOn:
        id: ${output.profile.logoutButton}
        
    # Verify logout confirmation or immediate logout
    - waitForAnimationToEnd
    - assertVisible:
        id: ${output.login.screen}
        
    # Verify we're back to login screen
    - assertVisible:
        id: ${output.login.title}
    - assertVisible:
        id: ${output.login.emailInput}
    - assertVisible:
        id: ${output.login.passwordInput}
        
    # Test Case 9: Verify Form is Reset After Logout
    - assertVisible:
        id: ${output.login.submitButton}
        enabled: false
        
    # Test Case 10: Re-login to Verify Flow Works Multiple Times
    - tapOn:
        id: ${output.login.emailInput}
    - inputText: ${VALID_EMAIL}
    - tapOn:
        id: ${output.login.passwordInput}
    - inputText: ${VALID_PASSWORD}
    - tapOn:
        id: ${output.login.submitButton}
    
    - assertVisible:
        id: ${output.login.loadingOverlay}
    - waitForAnimationToEnd
    - assertVisible:
        id: ${output.home.screen}
        
    # Test Case 11: Accessibility - Screen Reader Navigation
    - assertVisible:
        id: ${output.home.screen}
        accessibilityRole: "main"
    - assertVisible:
        id: ${output.home.title}
        accessibilityRole: "header"
        
    # Test Case 12: Verify Dark Mode Support (if toggle available)
    - tapOn:
        id: ${output.navigation.profileTab}
    - assertVisible:
        id: ${output.profile.screen}
    
    # Check if dark mode toggle exists and test it
    - runFlow:
        when:
          visible:
            id: ${output.darkMode.toggleButton}
        commands:
          - tapOn:
              id: ${output.darkMode.toggleButton}
          - assertVisible:
              id: ${output.darkMode.indicator}
          - assertVisible:
              id: ${output.profile.screen}
              
    # Test Case 13: Performance - Verify Smooth Transitions
    - tapOn:
        id: ${output.navigation.homeTab}
    - waitForAnimationToEnd
    - assertVisible:
        id: ${output.home.screen}
    - tapOn:
        id: ${output.navigation.profileTab}
    - waitForAnimationToEnd
    - assertVisible:
        id: ${output.profile.screen}

metadata:
  name: "Login - Positive Flow"
  description: "Tests successful login flow, navigation, session management, logout, accessibility, and user experience features"
  author: "Test Team"
  tags:
    - auth
    - login
    - positive-flow
    - navigation
    - session-management
    - accessibility
    - user-experience
    - performance
